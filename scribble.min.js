/*!
  * scribble.js - A javascript scribble pad 
  * https://github.com/jgallen23/scribble.js
  * copyright JGA 2011
  * MIT License
  */
!function(a,b){var c=typeof ender=="undefined"?a.Fidel:$.Fidel,d=c.extend({init:function(){var a=this;this.strokeWidth||(this.strokeWidth=2),this._points=[],this.origin=[0,0],this._scale=null,this.canvas=this.find("canvas")[0],this.context=this.canvas.getContext("2d"),this.clear(),this.readonly||this._loop()},events:{mousedown:"_start",mousemove:"_move",mouseup:"_end",touchstart:"_start",touchmove:"_move",touchend:"_end"},_getPoint:function(a){var b,c;if(this._offset===null){var d=0;this._offset=[this.el[0].offsetLeft+d,this.el[0].offsetTop+d]}a.touches?(b=a.touches[0].clientX-this.offset[0]-window.scrollX,c=a.touches[0].clientY-this.offset[1]-window.scrollY):(b=a.clientX-this._offset[0],c=a.clientY-this._offset[1]);return[b,c]},_start:function(a){this._drawing=!0;var b=this._getPoint(a);this._lastPoint=b,this._points.push(b);return a.preventDefault()},_move:function(a){this._drawing&&(this._moved=!0,this._points.push(this._getPoint(a)))},_end:function(a){this._drawing&&(this._moved||this._points.push(this._lastPoint,[this._lastPoint[0]+2,this._lastPoint[1]+2]),this._drawing=!1,this._moved=!1,this._points.push(null))},_loop:function(){var a=this,b=!1,c=0;setInterval(function(){if(a._points.length!==0){a.context.beginPath();while(a._points.length>c){var e=a._points[c];e?(a.drawPoints([a._lastPoint,e]),a._lastPoint=e):b=!0,c++}a.context.stroke(),b&&(a.strokes.push(a._points),a._points=[],c=0,b=!1,a.trigger("end"))}},30)},drawPoints:function(a){this.context.lineWidth=this.strokeWidth,this.context.lineCap="round",this.context.lineJoin="round";for(var b=0,c=a.length;b<c;b++){var d=a[b];if(!d)continue;b===0?this.context.moveTo(d[0]-this.origin[0],d[1]-this.origin[1]):this.context.lineTo(d[0]-this.origin[0],d[1]-this.origin[1])}},redraw:function(){this.canvas.width=this.canvas.width;var a=this;this.context.beginPath(),this._scale&&this.context.scale(this._scale[0],this._scale[1]);for(var b=0;b<this.strokes.length;b++){var c=this.strokes[b];this.drawPoints(c)}this.context.stroke()},load:function(a,b){this.origin=b||[0,0],this.strokes=a,this.redraw()},toJSON:function(){return this.strokes},imageData:function(){return this.canvas.toDataURL()},scale:function(a,b){this._scale=[a,b],this.redraw()},clear:function(){this._offset=null,this.strokes=[],this.context.clearRect(0,0,this.el[0].clientWidth,this.el[0].clientHeight),this.canvas.width=this.el[0].clientWidth,this.canvas.height=this.el[0].clientHeight,this.trigger("clear")}}),e=a.Scribble;d.noConflict=function(){a.Scribble=e;return this},a.Scribble=d}(this)